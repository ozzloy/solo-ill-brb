<VirtualHost *:80>
  ServerName ill-brb.example.com
  ProxyPreserveHost On
  ProxyRequests Off

  RewriteEngine on
  RewriteCond %{SERVER_NAME} =ill-brb.example.com
  RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
  ServerName ill-brb.example.com

  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/example.com-0001/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/example.com-0001/privkey.pem

  # proxy api requests to backend
  ProxyPass /api http://localhost:5001/api
  ProxyPassReverse /api http://localhost:5001/api

  # proxy all other requests to vite app
  ProxyPass / http://localhost:3001/
  ProxyPassReverse / http://localhost:3001/

  # enable required apache modules
  <Location />
    Require all granted
  </Location>
</VirtualHost>